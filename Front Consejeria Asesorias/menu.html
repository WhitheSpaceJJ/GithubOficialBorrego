<!DOCTYPE html>
<html>

<head>
    <title>Sistema Asesoría</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <link href="css/estilos.css" rel="stylesheet" type="text/css" />
    <style>
        .text-custom {
            color: white;
            font-size: inherit;
            text-decoration: none;
        }
    </style>
    <script>
        // Función para obtener los parámetros de la URL
        function obtenerParametrosURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('data');
            return data;
        }

        // Función para decodificar y analizar el JSON
        function analizarDatosJSON(data) {
            if (data) {
                try {
                    const decodedData = decodeURIComponent(data);
                    const jsonData = JSON.parse(decodedData);
                    return jsonData;
                } catch (error) {
                    console.error('Error al analizar los datos JSON:', error);
                }
            }
            return null;
        }

        // Declarar una variable global para almacenar los datos
        let datosAnalizadosGlobal = null;

        // Función para redirigir a la página de inicio de sesión si no hay datos
        function redirigirSiNoHayDatos() {
            const data = obtenerParametrosURL();
            const datosAnalizados = analizarDatosJSON(data);
            if (!datosAnalizados) {
                window.location.href = 'login.html';
            } else {
                const usuario = document.getElementById("user-name");
                const nombreCompleto = datosAnalizados.name;
                const palabras = nombreCompleto.split(" ");
                const primerNombre = palabras[0];

                usuario.innerHTML = primerNombre;

                // Almacenar los datos en la variable global
                datosAnalizadosGlobal = datosAnalizados;

                // Eliminar los parámetros de la URL
                if (history.replaceState) {
                    const nuevaURL = window.location.pathname; // Obtener la ruta de la página actual
                    history.replaceState({}, document.title, nuevaURL);
                }
            }
        }
        function turnar() {
            const dataString = JSON.stringify(datosAnalizadosGlobal);
            const encodedData = encodeURIComponent(dataString);
            window.location.href = `busqueda-turnar.html?data=${encodedData}`;
        }
        function asesoria() {
            const dataString = JSON.stringify(datosAnalizadosGlobal);
            const encodedData = encodeURIComponent(dataString);
            window.location.href = `asesoria.html?data=${encodedData}`;
        }
     
        // Llamar a la función de redirección al cargar la página
        window.addEventListener('load', redirigirSiNoHayDatos);
    </script>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#99260E;">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="img/DPS.png" width="75" height="75" alt="" class="mr-5">
            </a>
            <div class="d-flex align-items-center">
                <ul class="navbar-nav mr-5">
                    <li class="nav-item">
                        <a class="nav-link  h5" id="navbardrop" data-toggle="dropdown" 
                       
                        style="color:white;">INICIO</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle h5" id="navbardrop" data-toggle="dropdown"
                            style="color:white; ">
                            SERVICIO
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="asesoria()">
                                <p style="font-size: 20px;">Registrar asesoria</p>
                            </a>
                            <a class="dropdown-item" onclick="turnar()">
                                <p style="font-size: 20px;">Turnar asesoria</p>
                            </a>
                        </div>
                    </li>

                    <li class="nav-item ">
                        <a class="nav-link  h5" id="navbardrop" data-toggle="dropdown" style="color:white;">
                            CONSULTA
                        </a>

                    </li>
                </ul>
                <div class="d-flex align-self">
                    <div class="text-white  h5 d-flex flex-column align-items-center">
                        <label>Usuario</label>
                        <label id="user-name"></label>
                    </div>
                    <div>
                        <img src="img/perfil.png" width="60" height="60" alt="">
                    </div>
                </div>
            </div>

        </div>
    </nav>

    <nav class="navbar navbar-dark" style="background-color:#704414;">
    </nav>

</body>

</html>