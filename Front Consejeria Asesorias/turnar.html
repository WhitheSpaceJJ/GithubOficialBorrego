<!DOCTYPE html>
<html>

<head>
    <title>Sistema Asesoría</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <link href="css/estilos.css" rel="stylesheet" type="text/css" />
    <style>
        .text-custom {
            color: white;
            font-size: inherit;
            text-decoration: none;
        }
    </style>
    <script>
   
        function mostrarElemento(id) {
            let elemento = document.getElementById(id);
            elemento.style.display = 'block';
        }

        function ocultarElemento(id) {
            let elemento = document.getElementById(id);
            elemento.style.display = 'none';
        }
        function motivo() {

        }

        function registrarTurno() {
            alert(JSON.stringify(asesoriaGlobal));
        }
        // Función para obtener los parámetros de la URL
        function obtenerParametrosURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('data');
            return data;
        }
        function obtenerAsesoria() {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('asesoria');
            return data;
        }
        function obtenerDataColonia() {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('dataColonia');
            return data;
        }
        // Función para decodificar y analizar el JSON
        function analizarDatosJSON(data) {
            if (data) {
                try {
                    const decodedData = decodeURIComponent(data);
                    const jsonData = JSON.parse(decodedData);
                    return jsonData;
                } catch (error) {
                    console.error('Error al analizar los datos JSON:', error);
                }
            }
            return null;
        }

        // Declarar una variable global para almacenar los datos
        let datosAnalizadosGlobal = null;
        let asesoriaGlobal = null;
        let datosColoniaGlobal = null;
        // Función para redirigir a la página de inicio de sesión si no hay datos
        function redirigirSiNoHayDatos() {
            const data = obtenerParametrosURL();
            const datosAnalizados = analizarDatosJSON(data);
            const dataAsesoria = obtenerAsesoria();

            const dataColonia = obtenerDataColonia();

            const asesoria = analizarDatosJSON(dataAsesoria);
            const datosColonia = analizarDatosJSON(dataColonia);

            if (!datosAnalizados) {
                window.location.href = 'login.html';
            } else {
                const usuario = document.getElementById("user-name");
                const nombreCompleto = datosAnalizados.name;
                const palabras = nombreCompleto.split(" ");
                const primerNombre = palabras[0];

                usuario.innerHTML = primerNombre;

                // Almacenar los datos en la variable global
                datosAnalizadosGlobal = datosAnalizados;
                asesoriaGlobal = asesoria.asesoria;
                datosColoniaGlobal = datosColonia.colonia;
                rellenarAsesoria(asesoriaGlobal);
                rellenarDataColonia(datosColoniaGlobal);

                // Eliminar los parámetros de la URL
                if (history.replaceState) {
                    const nuevaURL = window.location.pathname; // Obtener la ruta de la página actual
                    history.replaceState({}, document.title, nuevaURL);
                }
            }
        }
        function rellenarAsesoria(asesoria) {
            // Crea variables para cada campo y asigna "----------" si el campo está ausente o es null
            const nombre = asesoria.persona.nombre || "----------";
            const apellidoPaterno = asesoria.persona.apellido_paterno || "----------";
            const apellidoMaterno = asesoria.persona.apellido_materno || "----------";
            const edad = asesoria.persona.edad || "----------";
            const sexo = asesoria.persona.genero.descripcion_genero || "----------";
            const calle = asesoria.persona.domicilio.calle_domicilio || "----------";
            const numExterior = asesoria.persona.domicilio.numero_exterior_domicilio || "----------";
            const numInterior = asesoria.persona.domicilio.numero_interior_domicilio || "----------";
            // Accede al elemento HTML del resumen de hechos y asigna el valor o "----------"
            const resumenHechos = asesoria.datos_asesoria.resumen_asesoria || "----------";
            document.getElementById("resumenHechosTI").innerHTML = resumenHechos;

            // Accede a los elementos HTML correspondientes y asigna el valor de las variables
            document.getElementById("nombreTI").innerHTML = nombre;
            document.getElementById("apellidoPaternoTI").innerHTML = apellidoPaterno;
            document.getElementById("apellidoMaternoTI").innerHTML = apellidoMaterno;
            document.getElementById("edadTI").innerHTML = edad;
            document.getElementById("sexoTI").innerHTML = sexo;
            document.getElementById("calleTI").innerHTML = calle;
            document.getElementById("numExteriorTI").innerHTML = numExterior;
            document.getElementById("numInteriorTI").innerHTML = numInterior;
        }

        function rellenarDataColonia(datosColonia) {
            // Crea variables para cada campo y asigna "----------" si el campo está ausente o es null
            const codigoPostal = datosColonia.codigo_postal.codigo_postal || "----------";
            const estado = datosColonia.estado.nombre_estado || "----------";
            const municipio = datosColonia.municipio.nombre_municipio || "----------";
            const ciudad = datosColonia.ciudad.nombre_ciudad || "----------";
            const colonia = datosColonia.colonia.nombre_colonia || "----------";

            // Accede a los elementos HTML correspondientes y asigna el valor de las variables
            document.getElementById("codigoPostalTI").innerHTML = codigoPostal;
            document.getElementById("estadoTI").innerHTML = estado;
            document.getElementById("municipioTI").innerHTML = municipio;
            document.getElementById("ciudadTI").innerHTML = ciudad;
            document.getElementById("coloniaTI").innerHTML = colonia;
        }


        function asesoria() {
            const dataString = JSON.stringify(datosAnalizadosGlobal);
            const encodedData = encodeURIComponent(dataString);
            window.location.href = `asesoria.html?data=${encodedData}`;
        }
        function menu() {
            const dataString = JSON.stringify(datosAnalizadosGlobal);
            const encodedData = encodeURIComponent(dataString);
            window.location.href = `menu.html?data=${encodedData}`;
        }
        window.addEventListener('load', redirigirSiNoHayDatos);
    </script>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#99260E;">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="img/DPS.png" width="75" height="75" alt="" class="mr-5">
            </a>
            <div class="d-flex align-items-center">
                <ul class="navbar-nav mr-5">
                    <li class="nav-item">
                        <a class="nav-link  h5" onclick="menu()" id="navbardrop" data-toggle="dropdown"
                            style="color:white;">INICIO</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle h5" id="navbardrop" data-toggle="dropdown"
                            style="color:white; ">
                            SERVICIO
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="asesoria()">
                                <p style="font-size: 20px;">Registrar asesoria</p>
                            </a>

                        </div>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link  h5" id="navbardrop" data-toggle="dropdown" style="color:white;">
                            CONSULTA
                        </a>

                    </li>
                </ul>
                <div class="d-flex align-self">
                    <div class="text-white  h5 d-flex flex-column align-items-center">
                        <label>Usuario</label>
                        <label id="user-name"></label>
                    </div>
                    <div>
                        <img src="img/perfil.png" width="60" height="60" alt="">
                    </div>
                </div>
            </div>

        </div>
    </nav>

    <nav class="navbar navbar-dark" style="background-color:#704414;">
        <div id="titulo" class="d-flex justify-content-start  px-5">
            <label style="color:white;">REGISTRO DE TURNO</label>
        </div>
    </nav>
    <br>
    <div class="tab-container">


        <div id="tab3" class="tab">
            <a href="#tab3">TURNO</a>
            <div class="tab-content">

                <div class="container">
                    <div class="form-row col-12 d-flex justify-content-between">
                        <div class="col-3 mb-3 h5 d-flex flex-column">
                            <label>Nombre</label>
                            <label id="nombreTI" name="nombreTN"></label>
                        </div>
                        <div class="col-3 mb-3 h5 d-flex flex-column">
                            <label>Apellido Paterno</label>
                            <label id="apellidoPaternoTI" name="apellidoPaternoTN"></label>
                        </div>
                        <div class="col-3 mb-3 h5 d-flex flex-column">
                            <label>Apellido Materno</label>
                            <label id="apellidoMaternoTI" name="apellidoMaternoTN"></label>
                        </div>
                    </div>

                    <div class="form-row col-12 d-flex justify-content-between">
                        <div class="col-3 mb-3 h5 d-flex flex-column">
                            <label>Edad</label>
                            <label id="edadTI" name="edadTN"></label>
                        </div>
                        <div class="col-3 mb-3 h5 d-flex flex-column">
                            <label>Sexo</label>
                            <label id="sexoTI" name="sexoTN"></label>
                        </div>
                        <div class="col-3 mb-3 h5 d-flex flex-column">

                        </div>
                    </div>
                </div>

                <br>
                <h4 style="background-color: #99260E;
                    margin-left: 3%;
                    margin-bottom: -5px; width: 15%;
                    text-align: center;">Domicilio</h4>
                <div class="domicilio" style="background-color: #f2f2f2;
                   ">
                    <div class="container">
                        <div class="form-row col-12 d-flex justify-content-between">
                            <div class="col-3 mb-3 h5 d-flex flex-column">
                                <label>Calle</label>
                                <label id="calleTI" name="calleTN"></label>
                            </div>
                            <div class="col-3 mb-3 h5 d-flex flex-column">
                                <label>Numero Exterior</label>
                                <label id="numExteriorTI" name="numExteriorTN"></label>
                            </div>
                            <div class="col-3 mb-3 h5 d-flex flex-column">
                                <label>Numero Interior</label>
                                <label id="numInteriorTI" name="numInteriorTN"></label>
                            </div>
                        </div>
                        <div class="form-row col-12 d-flex justify-content-between">
                            <div class="col-3 mb-3 h5 d-flex flex-column">
                                <label>Codigo Postal</label>
                                <label id="codigoPostalTI" name="codigoPostalTN"></label>
                            </div>
                            <div class="col-3 mb-3 h5 d-flex flex-column">
                                <label>Estado</label>
                                <label id="estadoTI" name="estadoTN"></label>
                            </div>
                            <div class="col-3 mb-3 h5 d-flex flex-column">
                                <label>Municipio</label>
                                <label id="municipioTI" name="municipioTN"></label>
                            </div>
                        </div>
                        <div class="form-row col-12 d-flex justify-content-between">
                            <div class="col-3 mb-3 h5 d-flex flex-column">
                                <label>Ciudad</label>
                                <label id="ciudadTI" name="ciudadTN"></label>
                            </div>
                            <div class="col-3 mb-3 h5 d-flex flex-column">
                                <label>Colonia</label>
                                <label id="coloniaTI" name="coloniaTN"></label>
                            </div>
                            <div class="col-3 mb-3 h5 d-flex flex-column">

                            </div>
                        </div>
                    </div>

                </div>
                <div class="container">
                    <div class="mb-2 mt-2  h5  w-100" style="text-align: start;">
                        <label for="resumen">Resumen de los hechos:</label>
                        <textarea class="w-100" id="resumenHechosTI" name="resumenHechosTN"></textarea>
                    </div>
                </div>
                <div class="container">
                    <div class="asesor h5">
                        <label>Nombre del asesor</label><label style="color:red;">*</label>
                        <br>
                        <select name="nombreDeAsesorTN" class="btn btn-light border border-danger col-md-5"
                            id="nombreDeAsesorTI">
                        </select>
                    </div>
                    <br>
                    <div class="tipoJuicioAplica h5">
                        <label>Responsable de turno</label><label style="color:red;">*</label>
                        <br>
                        <select name="responsableTurnoTN" class="btn btn-light border border-danger col-md-5"
                            id="responsableTurnoTI">
                        </select>
                    </div>
                    <div class="horaAtencion h5">
                        <label>Hora Atencion</label><label style="color:red;">*</label>
                        <br>
                        <input type="number" class="border border-danger btn btn-light border col-1" id="horaTI"
                            name="horaTN">
                        <label style="color:black;"> / </label>
                        <input type="number" class="border border-danger btn btn-light border col-1" id="minutoTI"
                            name="minutoTN">
                    </div>
                    <div class="h5">
                        <input type="checkbox" id="turnadoTI" name="turnadoTN" value="turno">
                        <label>¿El usuario fue turnado con un asesor?</label><label style="color:red;">*</label>
                    </div>

                </div>
                <br>
            </div>
            <div class="container">
                <button onclick="registrarTurno()" id="registrarTurnoTI" name="registrarTurnoTN"
                    class="btn btn-danger float-right mt-4 p-4 w-25"
                    style="margin-bottom: 20px; font-size: 20px;">Registrar</button>
                <br>
            </div>
        </div>

    </div>


</body>

</html>